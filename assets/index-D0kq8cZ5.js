var N=Object.defineProperty;var R=(n,e,t)=>e in n?N(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var h=(n,e,t)=>R(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(s){if(s.ep)return;s.ep=!0;const l=t(s);fetch(s.href,l)}})();const f=8,H={p:1,n:3,b:3,r:5,q:9,k:100},X={b:"♝",q:"♛",r:"♜",k:"♚",p:"♟",n:"♞"},Y=`br,bn,bb,bq,bk,bb,bn,br
bp,bp,bp,bp,bp,bp,bp,bp
,,,,,,,
,,,,,,,
,,,,,,,
,,,,,,,
wp,wp,wp,wp,wp,wp,wp,wp
wr,wn,wb,wq,wk,wb,wn,wr`,j=Y.split(`
`).map(n=>n.split(","));function F(n,e,t,i){const s=[];for(let l=-1;l<2;l++)for(let c=-1;c<2;c++)l===0&&c===0||s.push({x:e.x+l,y:e.y+c});return!i&&t==="w"&&n.canWhiteCastleQueenside&&!n.whiteChecked&&n.board[e.y][e.x-1]===""&&n.board[e.y][e.x-2]===""&&n.board[e.y][e.x-3]===""?s.push(...M(n,e,"b","q")):!i&&t==="b"&&n.canBlackCastleQueenside&&!n.blackChecked&&n.board[e.y][e.x-1]===""&&n.board[e.y][e.x-2]===""&&n.board[e.y][e.x-3]===""&&s.push(...M(n,e,"w","q")),!i&&t==="w"&&n.canWhiteCastleKingside&&!n.whiteChecked&&n.board[e.y][e.x+1]===""&&n.board[e.y][e.x+2]===""?s.push(...M(n,e,"b","k")):!i&&t==="b"&&n.canBlackCastleKingside&&!n.blackChecked&&n.board[e.y][e.x+1]===""&&n.board[e.y][e.x+2]===""&&s.push(...M(n,e,"w","k")),s.filter(E).filter(l=>!O(n,l,t))}function M(n,e,t,i){const s=i==="q"?-1:1,l=i==="q"?-2:2;let c=!0;e:for(let a=0;a<f;a++)for(let r=0;r<f;r++){const o=n.board[a][r];if((o==null?void 0:o[0])===t&&V(n,{x:r,y:a},n.board[a][r],!0).some(b=>b.x===e.x+s&&b.y===e.y)){c=!1;break e}}return c?[{x:e.x+l,y:e.y}]:[]}function I(n,e,t){return[{x:e.x+1,y:e.y+2},{x:e.x+2,y:e.y+1},{x:e.x-1,y:e.y+2},{x:e.x-2,y:e.y+1},{x:e.x+1,y:e.y-2},{x:e.x+2,y:e.y-1},{x:e.x-1,y:e.y-2},{x:e.x-2,y:e.y-1}].filter(s=>E(s)).filter(s=>!O(n,s,t))}function U(n,e,t){const i=[],s=t==="w"?[...e.y!==0?[{x:e.x,y:e.y-1}]:[]]:[...e.y!==7?[{x:e.x,y:e.y+1}]:[]];s.length&&!g(n,s[0])&&s.push(...t==="w"?[...e.y===6?[{x:e.x,y:e.y-2}]:[]]:[...e.y===1?[{x:e.x,y:e.y+2}]:[]]);const l=t==="w"?[{x:e.x-1,y:e.y-1},{x:e.x+1,y:e.y-1}]:[{x:e.x-1,y:e.y+1},{x:e.x+1,y:e.y+1}];return i.push(...s.filter(E).filter(c=>!g(n,c))),i.push(...l.filter(E).filter(c=>{var r,o,d,b;const a=n.board[c.y][c.x];return t==="w"&&((r=n.blackEnPassant)==null?void 0:r.x)===c.x&&((o=n.blackEnPassant)==null?void 0:o.y)===c.y||t==="b"&&((d=n.whiteEnPassant)==null?void 0:d.x)===c.x&&((b=n.whiteEnPassant)==null?void 0:b.y)===c.y?!0:!((a==null?void 0:a[0])===void 0||a[0]===t)})),i}function P(n,e,t){return[...v(n,e,t,new Array(f).fill(null).map((i,s)=>({x:-s}))),...v(n,e,t,new Array(f).fill(null).map((i,s)=>({x:+s}))),...v(n,e,t,new Array(f).fill(null).map((i,s)=>({y:-s}))),...v(n,e,t,new Array(f).fill(null).map((i,s)=>({y:+s})))]}function Z(n,e,t){return[...$(n,e,t),...P(n,e,t)]}const E=n=>n.x<f&&n.x>=0&&n.y<f&&n.y>=0,g=(n,e)=>n.board[e.y][e.x]!=="",O=(n,e,t)=>{const i=n.board[e.y][e.x];return(i==null?void 0:i[0])===t};function K(n,e,t){return V(n,e,t).filter(s=>{const l=new A({...n,onEndTurn:null,onMove:null});return l.move(e,s),l.endTurn(),t[0]==="w"?!l.whiteChecked:!l.blackChecked})}function V(n,e,t,i){const s=t[0],l=t[1];return l==="p"?U(n,e,s):l==="n"?I(n,e,s):l==="b"?$(n,e,s):l==="r"?P(n,e,s):l==="k"?F(n,e,s,i):l==="q"?Z(n,e,s):[]}function W(n,e){return n===0||n===f-1||e===0||e===f-1}function v(n,e,t,i){const s=[];for(let l of i){if(!l.x&&!l.y)continue;const c={x:e.x+(l.x||0),y:e.y+(l.y||0)};if(!E(c)||O(n,c,t)||(s.push(c),g(n,c)))break}return s}function z(n){return n>1e4?Math.round(n/100)/10+"k":n}function B(n,e){for(let t=0;t<f;t++)for(let i=0;i<f;i++)if(n.board[t][i]===e)return{x:i,y:t}}function $(n,e,t){return[...v(n,e,t,new Array(f).fill(null).map((i,s)=>({x:-s,y:-s}))),...v(n,e,t,new Array(f).fill(null).map((i,s)=>({x:+s,y:-s}))),...v(n,e,t,new Array(f).fill(null).map((i,s)=>({x:-s,y:+s}))),...v(n,e,t,new Array(f).fill(null).map((i,s)=>({x:+s,y:+s})))]}class A{constructor(e){h(this,"turn",0);h(this,"moves",0);h(this,"result",null);h(this,"canWhiteCastleQueenside",!0);h(this,"canWhiteCastleKingside",!0);h(this,"canBlackCastleQueenside",!0);h(this,"canBlackCastleKingside",!0);h(this,"whiteChecked",!1);h(this,"blackChecked",!1);h(this,"whiteEnPassant",null);h(this,"blackEnPassant",null);h(this,"clickLayer",null);h(this,"piecesElement",null);h(this,"cellsElement",null);h(this,"statusText",null);h(this,"gameMode","cpu");h(this,"onEndTurn",null);h(this,"onMove",null);this.board=e.board.map(t=>[...t]),this.turn=e.turn??0,this.moves=e.moves??0,this.canWhiteCastleQueenside=e.canWhiteCastleQueenside??!0,this.canWhiteCastleKingside=e.canWhiteCastleKingside??!0,this.canBlackCastleQueenside=e.canBlackCastleQueenside??!0,this.canBlackCastleKingside=e.canBlackCastleKingside??!0,this.whiteChecked=e.whiteChecked??!1,this.blackChecked=e.blackChecked??!1,this.whiteEnPassant=e.whiteEnPassant,this.blackEnPassant=e.blackEnPassant,this.onEndTurn=e.onEndTurn,this.onMove=e.onMove}updateChecked(){this.blackChecked=!1,this.whiteChecked=!1;const e=this.turn===0?"w":"b",t=this.turn===0?"b":"w",i=B(this,e+"k");if(!i)return;const s=()=>{e==="b"?this.blackChecked=!0:this.whiteChecked=!0};if(I(this,i,e).some(o=>this.board[o.y][o.x]===t+"n")){s();return}if($(this,i,e).some(o=>this.board[o.y][o.x]===t+"b"||this.board[o.y][o.x]===t+"q")){s();return}if(P(this,i,e).some(o=>this.board[o.y][o.x]===t+"r"||this.board[o.y][o.x]===t+"q")){s();return}if((e==="b"?[{x:i.x+1,y:i.y+1},{x:i.x-1,y:i.y+1}]:[{x:i.x+1,y:i.y-1},{x:i.x-1,y:i.y-1}]).filter(E).some(o=>this.board[o.y][o.x]===t+"p")){s();return}}move(e,t){var l,c,a,r;const i=this.board[e.y][e.x];if(i==="wk"){const o=t.x-e.x;if(o===2){const d={x:7,y:7};this.move(d,{x:d.x-2,y:d.y})}if(o===-2){const d={x:0,y:7};this.move(d,{x:d.x+3,y:d.y})}this.canWhiteCastleQueenside=!1,this.canWhiteCastleKingside=!1}else if(i==="bk"){const o=t.x-e.x;if(o===2){const d={x:7,y:0};this.move(d,{x:d.x-2,y:d.y})}if(o===-2){const d={x:0,y:0};this.move(d,{x:d.x+3,y:d.y})}this.canBlackCastleQueenside=!1,this.canBlackCastleKingside=!1}i==="wr"?this.canWhiteCastleQueenside&&e.x===0?this.canWhiteCastleQueenside=!1:this.canWhiteCastleKingside&&e.x===7&&(this.canWhiteCastleKingside=!1):i==="br"&&(this.canBlackCastleQueenside&&e.x===0?this.canBlackCastleQueenside=!1:this.canBlackCastleKingside&&e.x===7&&(this.canBlackCastleKingside=!1)),this.board[t.y][t.x]=this.board[e.y][e.x],this.board[e.y][e.x]="";const s=t.y-e.y;i==="wp"&&t.x===((l=this.blackEnPassant)==null?void 0:l.x)&&t.y===((c=this.blackEnPassant)==null?void 0:c.y)?this.board[this.blackEnPassant.y+1][this.blackEnPassant.x]="":i==="bp"&&t.x===((a=this.whiteEnPassant)==null?void 0:a.x)&&t.y===((r=this.whiteEnPassant)==null?void 0:r.y)&&(this.board[this.whiteEnPassant.y-1][this.whiteEnPassant.x]=""),this.blackEnPassant=null,this.whiteEnPassant=null,i==="wp"&&s===-2?this.whiteEnPassant={x:t.x,y:t.y+1}:i==="bp"&&s===2&&(this.blackEnPassant={x:t.x,y:t.y-1}),i==="wp"&&t.y===0?this.board[t.y][t.x]="wq":i==="bp"&&t.y===7&&(this.board[t.y][t.x]="bq"),this.onMove&&this.onMove(e,t)}endTurn(){this.turn=1-this.turn,this.moves++,this.updateChecked(),this.onEndTurn&&this.onEndTurn()}}function G(n,e,t){let i=0;const s=_(n),l=e==="b"?"w":"b";let c=null;for(let a=0;a<f;a++)for(let r=0;r<f;r++){const o=n.board[a][r];if((o==null?void 0:o[0])===e){const d=o[1],b=W(r,a),D=K(n,{x:r,y:a},n.board[a][r]);for(let y of D){const C=W(y.x,y.y);let u=Math.random()*.1;const k=new A({...n,onEndTurn:null,onMove:null});if(k.move({x:r,y:a},y),k.endTurn(),i++,(e==="w"?k.blackChecked:k.whiteChecked)&&(u+=.6),d==="k")y.x-r===2?u+=.6:r-y.x===2?u+=.5:u-=.5;else if(d==="p"){const m=e==="b"?y.y:f-1-y.y;m>4&&(u+=m*.1),(r===3||r===4)&&y.x===r&&(Math.abs(a-y.y)===2?u+=.7:u+=.4)}else d==="n"||d==="b"?(b&&(u+=.5),C&&(u-=.2)):d==="q"?C&&(u-=.2):d==="r"&&C&&(u-=.2);if(t>0){const m=G(k,l,t-1);i+=m.count,m.bestMove?u-=m.bestMove.value:u+=1e3}const Q=_(k)-s;u+=e==="b"?-Q:Q,(c==null||u>(c==null?void 0:c.value))&&(c={fromSquare:{x:r,y:a},toSquare:y,value:u})}}}return c&&(n.move(c.fromSquare,c.toSquare),n.endTurn()),{bestMove:c,count:i}}function _(n){return n.board.flat().reduce((e,t)=>t?e+H[t[1]]*(t[0]==="w"?1:-1):e,0)}const J=3;class S{constructor(){h(this,"gameState",null);h(this,"clickLayer",null);h(this,"piecesElement",null);h(this,"cellsElement",null);h(this,"statusText",null);h(this,"gameMode","cpu");h(this,"onEndTurn",()=>{if(this.updateStatus(),this.render(),this.cellsElement.querySelectorAll(".check").forEach(e=>e.classList.remove("check")),this.gameState.blackChecked){const e=B(this.gameState,"bk");this.cellsElement.querySelector(`.cell-${e.x}-${e.y}`).classList.add("check")}if(this.gameState.whiteChecked){const e=B(this.gameState,"wk");this.cellsElement.querySelector(`.cell-${e.x}-${e.y}`).classList.add("check")}(this.gameState.turn===1&&this.gameMode==="cpu"||this.gameMode==="cvc")&&this.doCpuMove()});h(this,"onMove",(e,t)=>{var l,c;(l=this.cellsElement.querySelector(".last-move-from"))==null||l.classList.remove("last-move-from"),(c=this.cellsElement.querySelector(".last-move-to"))==null||c.classList.remove("last-move-to"),this.cellsElement.querySelector(`.cell-${e.x}-${e.y}`).classList.add("last-move-from"),this.cellsElement.querySelector(`.cell-${t.x}-${t.y}`).classList.add("last-move-to")});this.clickLayer=document.querySelector("#click-layer"),this.piecesElement=document.querySelector("#pieces"),this.cellsElement=document.querySelector("#cells"),this.statusText=document.querySelector("#status-text"),this.calculationsText=document.querySelector("#calculations"),this.moveText=document.querySelector("#move"),this.oneOnOneButton=document.querySelector("#oneOnOne"),this.cpuButton=document.querySelector("#cpu"),this.cvcButton=document.querySelector("#cvc"),this.oneOnOneButton.addEventListener("click",()=>this.setGameMode("1v1")),this.cpuButton.addEventListener("click",()=>this.setGameMode("cpu")),this.cvcButton.addEventListener("click",()=>this.setGameMode("cvc")),this.setGameMode("cpu")}init(){var e,t;this.gameState=new A({board:j,onEndTurn:this.onEndTurn,onMove:this.onMove}),this.updateStatus(),this.render(),this.calculationsText.innerHTML="&nbsp;",(e=this.cellsElement.querySelector(".last-move-from"))==null||e.classList.remove("last-move-from"),(t=this.cellsElement.querySelector(".last-move-to"))==null||t.classList.remove("last-move-to"),this.cellsElement.querySelectorAll(".check").forEach(i=>i.classList.remove("check")),this.gameMode==="cvc"&&this.doCpuMove()}doCpuMove(){setTimeout(()=>{const e=Date.now(),{count:t}=G(this.gameState,this.gameState.turn===0?"w":"b",J);this.calculationsText.textContent=`Evaluated ${z(t)} positions in ${Math.round((Date.now()-e)/100)/10}s`},100)}render(){this.piecesElement.innerHTML="",this.gameState.board.forEach((e,t)=>{e.forEach((i,s)=>{if(i!==""){const l=document.createElement("div");l.classList.add("piece",i[0]==="w"?"white":"black"),l.style.transform=`translate(${s*50}px, ${t*50}px)`,l.textContent=X[i[1]],this.piecesElement.appendChild(l)}})})}updateStatus(){const e=this.gameState.turn===0?"White":"Black";let t;this.gameMode==="1v1"?t=e+" to move":this.gameMode==="cpu"?t=e+(this.gameState.turn===0?" to move":" thinking..."):t=e+" thinking...",this.statusText.textContent=t,this.moveText.textContent=`Move ${Math.floor(this.gameState.moves/2)+1}`}setGameMode(e){this.gameMode=e,this.init();let t;e==="cpu"?t=this.cpuButton:e==="1v1"?t=this.oneOnOneButton:e==="cvc"&&(t=this.cvcButton),[this.cpuButton,this.oneOnOneButton,this.cvcButton].forEach(i=>i.classList.remove("selected")),t.classList.add("selected")}}const x=new S;for(let n=0;n<f;n++){const e=document.createElement("div");e.classList.add("row"),x.cellsElement.appendChild(e);for(let t=0;t<f;t++){const i=document.createElement("div");i.classList.add("cell",`cell-${t}-${n}`),e.appendChild(i)}}let L=null,p=null,T=null,w=[];const q=(n,e)=>{p&&p.classList.remove("selected"),w.length&&w.forEach(i=>i.classList.remove("valid-move")),w=[],p=x.cellsElement.querySelector(`.cell-${n.x}-${n.y}`),p.classList.add("selected"),L=n,T=e,K(x.gameState,n,e).forEach(i=>{const s=x.cellsElement.querySelector(`.cell-${i.x}-${i.y}`);s.classList.add("valid-move"),w.push(s)})},ee=n=>{const e={x:Math.floor(n.offsetX/50),y:Math.floor(n.offsetY/50)},t=x.gameState.board[e.y][e.x];if((t==null?void 0:t[0])===(x.gameState.turn===0?"w":"b")){q(e,t);return}!T||!K(x.gameState,L,T).some(s=>s.x===e.x&&s.y===e.y)||(w.length&&w.forEach(s=>s.classList.remove("valid-move")),x.gameState.move(L,e),T=null,L=null,p.classList.remove("selected"),p=null,x.gameState.endTurn())};x.clickLayer.addEventListener("click",ee);
