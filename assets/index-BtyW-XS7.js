var V=Object.defineProperty;var G=(t,e,n)=>e in t?V(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var h=(t,e,n)=>G(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&l(c)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function l(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const o=8,I={p:1,n:3,b:3,r:5,q:9,k:100},j={b:"♝",q:"♛",r:"♜",k:"♚",p:"♟",n:"♞"};function Q(t,e,n){return[...x(t,e,n,new Array(o).fill(null).map((l,i)=>({x:-i,y:-i}))),...x(t,e,n,new Array(o).fill(null).map((l,i)=>({x:+i,y:-i}))),...x(t,e,n,new Array(o).fill(null).map((l,i)=>({x:-i,y:+i}))),...x(t,e,n,new Array(o).fill(null).map((l,i)=>({x:+i,y:+i})))]}function N(t,e,n,l){const i=[];for(let s=-1;s<2;s++)for(let c=-1;c<2;c++)s===0&&c===0||i.push({x:e.x+s,y:e.y+c});return!l&&n==="w"&&t.canWhiteCastleQueenside&&!t.whiteChecked&&t.board[e.y][e.x-1]===""&&t.board[e.y][e.x-2]===""&&t.board[e.y][e.x-3]===""?i.push(...p(t,e,"b","q")):!l&&n==="b"&&t.canBlackCastleQueenside&&!t.blackChecked&&t.board[e.y][e.x-1]===""&&t.board[e.y][e.x-2]===""&&t.board[e.y][e.x-3]===""&&i.push(...p(t,e,"w","q")),!l&&n==="w"&&t.canWhiteCastleKingside&&!t.whiteChecked&&t.board[e.y][e.x+1]===""&&t.board[e.y][e.x+2]===""?i.push(...p(t,e,"b","k")):!l&&n==="b"&&t.canBlackCastleKingside&&!t.blackChecked&&t.board[e.y][e.x+1]===""&&t.board[e.y][e.x+2]===""&&i.push(...p(t,e,"w","k")),i.filter(w).filter(s=>!T(t,s,n))}function p(t,e,n,l){const i=l==="q"?-1:1,s=l==="q"?-2:2;let c=!0;e:for(let r=0;r<o;r++)for(let d=0;d<o;d++){const f=t.board[r][d];if((f==null?void 0:f[0])===n&&B(t,{x:d,y:r},t.board[r][d],!0).some(b=>b.x===e.x+i&&b.y===e.y)){c=!1;break e}}return c?[{x:e.x+s,y:e.y}]:[]}function R(t,e,n){return[{x:e.x+1,y:e.y+2},{x:e.x+2,y:e.y+1},{x:e.x-1,y:e.y+2},{x:e.x-2,y:e.y+1},{x:e.x+1,y:e.y-2},{x:e.x+2,y:e.y-1},{x:e.x-1,y:e.y-2},{x:e.x-2,y:e.y-1}].filter(i=>w(i)).filter(i=>!T(t,i,n))}function D(t,e,n){const l=[],i=n==="w"?[...e.y!==0?[{x:e.x,y:e.y-1}]:[]]:[...e.y!==7?[{x:e.x,y:e.y+1}]:[]];i.length&&!L(t,i[0])&&i.push(...n==="w"?[...e.y===6?[{x:e.x,y:e.y-2}]:[]]:[...e.y===1?[{x:e.x,y:e.y+2}]:[]]);const s=n==="w"?[{x:e.x-1,y:e.y-1},{x:e.x+1,y:e.y-1}]:[{x:e.x-1,y:e.y+1},{x:e.x+1,y:e.y+1}];return l.push(...i.filter(w).filter(c=>!L(t,c))),l.push(...s.filter(w).filter(c=>{var d,f,a,b;const r=t.board[c.y][c.x];return n==="w"&&((d=t.blackEnPassant)==null?void 0:d.x)===c.x&&((f=t.blackEnPassant)==null?void 0:f.y)===c.y||n==="b"&&((a=t.whiteEnPassant)==null?void 0:a.x)===c.x&&((b=t.whiteEnPassant)==null?void 0:b.y)===c.y?!0:!((r==null?void 0:r[0])===void 0||r[0]===n)})),l}function _(t,e,n){return[...x(t,e,n,new Array(o).fill(null).map((l,i)=>({x:-i}))),...x(t,e,n,new Array(o).fill(null).map((l,i)=>({x:+i}))),...x(t,e,n,new Array(o).fill(null).map((l,i)=>({y:-i}))),...x(t,e,n,new Array(o).fill(null).map((l,i)=>({y:+i})))]}function X(t,e,n){return[...Q(t,e,n),..._(t,e,n)]}const w=t=>t.x<o&&t.x>=0&&t.y<o&&t.y>=0,L=(t,e)=>t.board[e.y][e.x]!=="",T=(t,e,n)=>{const l=t.board[e.y][e.x];return(l==null?void 0:l[0])===n};function P(t,e,n){return B(t,e,n).filter(i=>{const s=new O({...t,board:t.getBoardString(),sim:!0,onEndTurn:null,onMove:null});return s.move(e,i),s.endTurn(),n[0]==="w"?!s.whiteChecked:!s.blackChecked})}function B(t,e,n,l){const i=n[0],s=n[1];return s==="p"?D(t,e,i):s==="n"?R(t,e,i):s==="b"?Q(t,e,i):s==="r"?_(t,e,i):s==="k"?N(t,e,i,l):s==="q"?X(t,e,i):[]}function W(t,e){return t===0||t===o-1||e===0||e===o-1}function x(t,e,n,l){const i=[];for(let s of l){if(!s.x&&!s.y)continue;const c={x:e.x+(s.x||0),y:e.y+(s.y||0)};if(!w(c)||T(t,c,n)||(i.push(c),L(t,c)))break}return i}class O{constructor(e){h(this,"turn",0);h(this,"result",null);h(this,"canWhiteCastleQueenside",!0);h(this,"canWhiteCastleKingside",!0);h(this,"canBlackCastleQueenside",!0);h(this,"canBlackCastleKingside",!0);h(this,"whiteChecked",!1);h(this,"blackChecked",!1);h(this,"whiteEnPassant",null);h(this,"blackEnPassant",null);h(this,"clickLayer",null);h(this,"piecesElement",null);h(this,"cellsElement",null);h(this,"statusText",null);h(this,"gameMode","cpu");h(this,"onEndTurn",null);h(this,"onMove",null);this.board=e.board.split(`
`).map(n=>n.split(",")),this.turn=e.turn??0,this.canWhiteCastleQueenside=e.canWhiteCastleQueenside??!0,this.canWhiteCastleKingside=e.canWhiteCastleKingside??!0,this.canBlackCastleQueenside=e.canBlackCastleQueenside??!0,this.canBlackCastleKingside=e.canBlackCastleKingside??!0,this.whiteChecked=e.whiteChecked??!1,this.blackChecked=e.blackChecked??!1,this.whiteEnPassant=e.whiteEnPassant,this.blackEnPassant=e.blackEnPassant,this.onEndTurn=e.onEndTurn,this.onMove=e.onMove}updateChecked(){var l,i;this.blackChecked=!1,this.whiteChecked=!1;let e;for(let s=0;s<o;s++)for(let c=0;c<o;c++)if(this.board[s][c]==="bk"){e={x:c,y:s};break}for(let s=0;s<o;s++)for(let c=0;c<o;c++)if(((l=this.board[s][c])==null?void 0:l[0])==="w"&&B(this,{x:c,y:s},this.board[s][c]).some(d=>d.x===e.x&&d.y===e.y)){this.blackChecked=!0;break}let n;for(let s=0;s<o;s++)for(let c=0;c<o;c++)if(this.board[s][c]==="wk"){n={x:c,y:s};break}for(let s=0;s<o;s++)for(let c=0;c<o;c++)if(((i=this.board[s][c])==null?void 0:i[0])==="b"&&B(this,{x:c,y:s},this.board[s][c]).some(d=>d.x===n.x&&d.y===n.y)){this.whiteChecked=!0;break}}move(e,n){var s,c,r,d;const l=this.board[e.y][e.x];if(l==="wk"){const f=n.x-e.x;if(f===2){const a={x:7,y:7};this.move(a,{x:a.x-2,y:a.y})}if(f===-2){const a={x:0,y:7};this.move(a,{x:a.x+3,y:a.y})}this.canWhiteCastleQueenside=!1,this.canWhiteCastleKingside=!1}else if(l==="bk"){const f=n.x-e.x;if(f===2){const a={x:7,y:0};this.move(a,{x:a.x-2,y:a.y})}if(f===-2){const a={x:0,y:0};this.move(a,{x:a.x+3,y:a.y})}this.canBlackCastleQueenside=!1,this.canBlackCastleKingside=!1}l==="wr"?this.canWhiteCastleQueenside&&e.x===0?this.canWhiteCastleQueenside=!1:this.canWhiteCastleKingside&&e.x===7&&(this.canWhiteCastleKingside=!1):l==="br"&&(this.canBlackCastleQueenside&&e.x===0?this.canBlackCastleQueenside=!1:this.canBlackCastleKingside&&e.x===7&&(this.canBlackCastleKingside=!1)),this.board[n.y][n.x]=this.board[e.y][e.x],this.board[e.y][e.x]="";const i=n.y-e.y;l==="wp"&&n.x===((s=this.blackEnPassant)==null?void 0:s.x)&&n.y===((c=this.blackEnPassant)==null?void 0:c.y)?this.board[this.blackEnPassant.y+1][this.blackEnPassant.x]="":l==="bp"&&n.x===((r=this.whiteEnPassant)==null?void 0:r.x)&&n.y===((d=this.whiteEnPassant)==null?void 0:d.y)&&(this.board[this.whiteEnPassant.y-1][this.whiteEnPassant.x]=""),this.blackEnPassant=null,this.whiteEnPassant=null,l==="wp"&&i===-2?this.whiteEnPassant={x:n.x,y:n.y+1}:l==="bp"&&i===2&&(this.blackEnPassant={x:n.x,y:n.y-1}),l==="wp"&&n.y===0?this.board[n.y][n.x]="wq":l==="bp"&&n.y===7&&(this.board[n.y][n.x]="bq"),this.onMove&&this.onMove(e,n)}endTurn(){this.turn=1-this.turn,this.updateChecked(),this.onEndTurn&&this.onEndTurn()}getBoardString(){return this.board.map(e=>e.join(",")).join(`
`)}}function C(t,e,n){const l=$(t),i=e==="b"?"w":"b";let s=null;for(let c=0;c<o;c++)for(let r=0;r<o;r++){const d=t.board[c][r];if((d==null?void 0:d[0])===e){const f=d[1],a=W(r,c),b=P(t,{x:r,y:c},t.board[c][r]);for(let k of b){const K=W(k.x,k.y);let y=Math.random()*.2-.1;const E=new O({...t,board:t.getBoardString(),sim:!0,onEndTurn:null,onMove:null});E.move({x:r,y:c},k),E.endTurn(),f==="k"?Math.abs(r-k.x)===2?y+=.5:y-=.5:f==="p"?(r===3||r===4)&&(Math.abs(c-k.y)===2?y+=.7:y+=.4):(f==="n"||f==="b")&&(a&&(y+=.5),K&&(y-=.2)),n>0&&C(E,i,n-1);const A=$(E)-l;y+=e==="b"?-A:A,(s==null||y>(s==null?void 0:s.value))&&(s={fromSquare:{x:r,y:c},toSquare:k,value:y})}}}s&&(t.move(s.fromSquare,s.toSquare),t.endTurn())}function $(t){return t.board.flat().reduce((e,n)=>n?e+I[n[1]]*(n[0]==="w"?1:-1):e,0)}class H{constructor(){h(this,"gameState",null);h(this,"clickLayer",null);h(this,"piecesElement",null);h(this,"cellsElement",null);h(this,"statusText",null);h(this,"gameMode","cpu");h(this,"onEndTurn",()=>{if(this.updateStatus(),this.render(),this.cellsElement.querySelectorAll(".check").forEach(e=>e.classList.remove("check")),this.gameState.blackChecked){let e;for(let l=0;l<o;l++)for(let i=0;i<o;i++)if(this.gameState.board[l][i]==="bk"){e={x:i,y:l};break}this.cellsElement.querySelector(`.cell-${e.x}-${e.y}`).classList.add("check")}if(this.gameState.whiteChecked){let e;for(let l=0;l<o;l++)for(let i=0;i<o;i++)if(this.gameState.board[l][i]==="wk"){e={x:i,y:l};break}this.cellsElement.querySelector(`.cell-${e.x}-${e.y}`).classList.add("check")}setTimeout(()=>{this.gameState.turn===1&&this.gameMode==="cpu"?C(this.gameState,"b",2):this.gameMode==="cvc"&&C(this.gameState,this.gameState.turn===0?"w":"b",2)},100)});h(this,"onMove",(e,n)=>{var s,c;(s=this.cellsElement.querySelector(".last-move-from"))==null||s.classList.remove("last-move-from"),(c=this.cellsElement.querySelector(".last-move-to"))==null||c.classList.remove("last-move-to"),this.cellsElement.querySelector(`.cell-${e.x}-${e.y}`).classList.add("last-move-from"),this.cellsElement.querySelector(`.cell-${n.x}-${n.y}`).classList.add("last-move-to")});this.clickLayer=document.querySelector("#click-layer"),this.piecesElement=document.querySelector("#pieces"),this.cellsElement=document.querySelector("#cells"),this.statusText=document.querySelector("#status-text"),this.oneOnOneButton=document.querySelector("#oneOnOne"),this.cpuButton=document.querySelector("#cpu"),this.cvcButton=document.querySelector("#cvc"),this.oneOnOneButton.addEventListener("click",()=>this.setGameMode("1v1")),this.cpuButton.addEventListener("click",()=>this.setGameMode("cpu")),this.cvcButton.addEventListener("click",()=>this.setGameMode("cvc")),this.setGameMode("cpu")}init(){var e,n;this.gameState=new O({board:`br,bn,bb,bq,bk,bb,bn,br
bp,bp,bp,bp,bp,bp,bp,bp
,,,,,,,
,,,,,,,
,,,,,,,
,,,,,,,
wp,wp,wp,wp,wp,wp,wp,wp
wr,wn,wb,wq,wk,wb,wn,wr`,onEndTurn:this.onEndTurn,onMove:this.onMove}),this.updateStatus(),this.render(),(e=this.cellsElement.querySelector(".last-move-from"))==null||e.classList.remove("last-move-from"),(n=this.cellsElement.querySelector(".last-move-to"))==null||n.classList.remove("last-move-to"),this.cellsElement.querySelectorAll(".check").forEach(l=>l.classList.remove("check")),this.gameMode==="cvc"&&setTimeout(()=>{C(this.gameState,this.gameState.turn===0?"w":"b",2)},100)}render(){this.piecesElement.innerHTML="",this.gameState.board.forEach((e,n)=>{e.forEach((l,i)=>{if(l!==""){const s=document.createElement("div");s.classList.add("piece",l[0]==="w"?"white":"black"),s.style.transform=`translate(${i*50}px, ${n*50}px)`,s.textContent=j[l[1]],this.piecesElement.appendChild(s)}})})}updateStatus(){let e;this.gameMode==="1v1"?e=(this.gameState.turn===0?"White":"Black")+" to move":this.gameMode==="cpu"?e=this.gameState.turn===0?"White to move":"Thinking...":e="Thinking...",this.statusText.textContent=e}setGameMode(e){this.gameMode=e,this.init();let n;e==="cpu"?n=this.cpuButton:e==="1v1"?n=this.oneOnOneButton:e==="cvc"&&(n=this.cvcButton),[this.cpuButton,this.oneOnOneButton,this.cvcButton].forEach(l=>l.classList.remove("selected")),n.classList.add("selected")}getBoardString(){return this.board.map(e=>e.join(",")).join(`
`)}}const u=new H;for(let t=0;t<o;t++){const e=document.createElement("div");e.classList.add("row"),u.cellsElement.appendChild(e);for(let n=0;n<o;n++){const l=document.createElement("div");l.classList.add("cell",`cell-${n}-${t}`),e.appendChild(l)}}let M=null,v=null,g=null,m=[];const Y=(t,e)=>{v&&v.classList.remove("selected"),m.length&&m.forEach(l=>l.classList.remove("valid-move")),m=[],v=u.cellsElement.querySelector(`.cell-${t.x}-${t.y}`),v.classList.add("selected"),M=t,g=e,P(u.gameState,t,e).forEach(l=>{const i=u.cellsElement.querySelector(`.cell-${l.x}-${l.y}`);i.classList.add("valid-move"),m.push(i)})},F=t=>{const e={x:Math.floor(t.offsetX/50),y:Math.floor(t.offsetY/50)},n=u.gameState.board[e.y][e.x];if((n==null?void 0:n[0])===(u.gameState.turn===0?"w":"b")){Y(e,n);return}!g||!P(u.gameState,M,g).some(i=>i.x===e.x&&i.y===e.y)||(m.length&&m.forEach(i=>i.classList.remove("valid-move")),u.gameState.move(M,e),g=null,M=null,v.classList.remove("selected"),v=null,u.gameState.endTurn())};u.clickLayer.addEventListener("click",F);
