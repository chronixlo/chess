var V=Object.defineProperty;var G=(n,e,t)=>e in n?V(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var r=(n,e,t)=>G(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&l(c)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function l(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();const o=8,D={p:1,n:3,b:3,r:5,q:9,k:100},N={b:"♝",q:"♛",r:"♜",k:"♚",p:"♟",n:"♞"},R=`br,bn,bb,bq,bk,bb,bn,br
bp,bp,bp,bp,bp,bp,bp,bp
,,,,,,,
,,,,,,,
,,,,,,,
,,,,,,,
wp,wp,wp,wp,wp,wp,wp,wp
wr,wn,wb,wq,wk,wb,wn,wr`,X=R.split(`
`).map(n=>n.split(","));function W(n,e,t){return[...b(n,e,t,new Array(o).fill(null).map((l,i)=>({x:-i,y:-i}))),...b(n,e,t,new Array(o).fill(null).map((l,i)=>({x:+i,y:-i}))),...b(n,e,t,new Array(o).fill(null).map((l,i)=>({x:-i,y:+i}))),...b(n,e,t,new Array(o).fill(null).map((l,i)=>({x:+i,y:+i})))]}function H(n,e,t,l){const i=[];for(let s=-1;s<2;s++)for(let c=-1;c<2;c++)s===0&&c===0||i.push({x:e.x+s,y:e.y+c});return!l&&t==="w"&&n.canWhiteCastleQueenside&&!n.whiteChecked&&n.board[e.y][e.x-1]===""&&n.board[e.y][e.x-2]===""&&n.board[e.y][e.x-3]===""?i.push(...M(n,e,"b","q")):!l&&t==="b"&&n.canBlackCastleQueenside&&!n.blackChecked&&n.board[e.y][e.x-1]===""&&n.board[e.y][e.x-2]===""&&n.board[e.y][e.x-3]===""&&i.push(...M(n,e,"w","q")),!l&&t==="w"&&n.canWhiteCastleKingside&&!n.whiteChecked&&n.board[e.y][e.x+1]===""&&n.board[e.y][e.x+2]===""?i.push(...M(n,e,"b","k")):!l&&t==="b"&&n.canBlackCastleKingside&&!n.blackChecked&&n.board[e.y][e.x+1]===""&&n.board[e.y][e.x+2]===""&&i.push(...M(n,e,"w","k")),i.filter(E).filter(s=>!P(n,s,t))}function M(n,e,t,l){const i=l==="q"?-1:1,s=l==="q"?-2:2;let c=!0;e:for(let h=0;h<o;h++)for(let d=0;d<o;d++){const f=n.board[h][d];if((f==null?void 0:f[0])===t&&g(n,{x:d,y:h},n.board[h][d],!0).some(v=>v.x===e.x+i&&v.y===e.y)){c=!1;break e}}return c?[{x:e.x+s,y:e.y}]:[]}function Y(n,e,t){return[{x:e.x+1,y:e.y+2},{x:e.x+2,y:e.y+1},{x:e.x-1,y:e.y+2},{x:e.x-2,y:e.y+1},{x:e.x+1,y:e.y-2},{x:e.x+2,y:e.y-1},{x:e.x-1,y:e.y-2},{x:e.x-2,y:e.y-1}].filter(i=>E(i)).filter(i=>!P(n,i,t))}function j(n,e,t){const l=[],i=t==="w"?[...e.y!==0?[{x:e.x,y:e.y-1}]:[]]:[...e.y!==7?[{x:e.x,y:e.y+1}]:[]];i.length&&!T(n,i[0])&&i.push(...t==="w"?[...e.y===6?[{x:e.x,y:e.y-2}]:[]]:[...e.y===1?[{x:e.x,y:e.y+2}]:[]]);const s=t==="w"?[{x:e.x-1,y:e.y-1},{x:e.x+1,y:e.y-1}]:[{x:e.x-1,y:e.y+1},{x:e.x+1,y:e.y+1}];return l.push(...i.filter(E).filter(c=>!T(n,c))),l.push(...s.filter(E).filter(c=>{var d,f,a,v;const h=n.board[c.y][c.x];return t==="w"&&((d=n.blackEnPassant)==null?void 0:d.x)===c.x&&((f=n.blackEnPassant)==null?void 0:f.y)===c.y||t==="b"&&((a=n.whiteEnPassant)==null?void 0:a.x)===c.x&&((v=n.whiteEnPassant)==null?void 0:v.y)===c.y?!0:!((h==null?void 0:h[0])===void 0||h[0]===t)})),l}function _(n,e,t){return[...b(n,e,t,new Array(o).fill(null).map((l,i)=>({x:-i}))),...b(n,e,t,new Array(o).fill(null).map((l,i)=>({x:+i}))),...b(n,e,t,new Array(o).fill(null).map((l,i)=>({y:-i}))),...b(n,e,t,new Array(o).fill(null).map((l,i)=>({y:+i})))]}function F(n,e,t){return[...W(n,e,t),..._(n,e,t)]}const E=n=>n.x<o&&n.x>=0&&n.y<o&&n.y>=0,T=(n,e)=>n.board[e.y][e.x]!=="",P=(n,e,t)=>{const l=n.board[e.y][e.x];return(l==null?void 0:l[0])===t};function O(n,e,t){return g(n,e,t).filter(i=>{const s=new K({...n,onEndTurn:null,onMove:null});return s.move(e,i),s.endTurn(),t[0]==="w"?!s.whiteChecked:!s.blackChecked})}function g(n,e,t,l){const i=t[0],s=t[1];return s==="p"?j(n,e,i):s==="n"?Y(n,e,i):s==="b"?W(n,e,i):s==="r"?_(n,e,i):s==="k"?H(n,e,i,l):s==="q"?F(n,e,i):[]}function $(n,e){return n===0||n===o-1||e===0||e===o-1}function b(n,e,t,l){const i=[];for(let s of l){if(!s.x&&!s.y)continue;const c={x:e.x+(s.x||0),y:e.y+(s.y||0)};if(!E(c)||P(n,c,t)||(i.push(c),T(n,c)))break}return i}class K{constructor(e){r(this,"turn",0);r(this,"moves",0);r(this,"result",null);r(this,"canWhiteCastleQueenside",!0);r(this,"canWhiteCastleKingside",!0);r(this,"canBlackCastleQueenside",!0);r(this,"canBlackCastleKingside",!0);r(this,"whiteChecked",!1);r(this,"blackChecked",!1);r(this,"whiteEnPassant",null);r(this,"blackEnPassant",null);r(this,"clickLayer",null);r(this,"piecesElement",null);r(this,"cellsElement",null);r(this,"statusText",null);r(this,"gameMode","cpu");r(this,"onEndTurn",null);r(this,"onMove",null);this.board=e.board.map(t=>[...t]),this.turn=e.turn??0,this.moves=e.moves??0,this.canWhiteCastleQueenside=e.canWhiteCastleQueenside??!0,this.canWhiteCastleKingside=e.canWhiteCastleKingside??!0,this.canBlackCastleQueenside=e.canBlackCastleQueenside??!0,this.canBlackCastleKingside=e.canBlackCastleKingside??!0,this.whiteChecked=e.whiteChecked??!1,this.blackChecked=e.blackChecked??!1,this.whiteEnPassant=e.whiteEnPassant,this.blackEnPassant=e.blackEnPassant,this.onEndTurn=e.onEndTurn,this.onMove=e.onMove}updateChecked(){var l,i;this.blackChecked=!1,this.whiteChecked=!1;let e;e:for(let s=0;s<o;s++)for(let c=0;c<o;c++)if(this.board[s][c]==="bk"){e={x:c,y:s};break e}e:for(let s=0;s<o;s++)for(let c=0;c<o;c++)if(((l=this.board[s][c])==null?void 0:l[0])==="w"&&g(this,{x:c,y:s},this.board[s][c]).some(d=>d.x===e.x&&d.y===e.y)){this.blackChecked=!0;break e}let t;e:for(let s=0;s<o;s++)for(let c=0;c<o;c++)if(this.board[s][c]==="wk"){t={x:c,y:s};break e}e:for(let s=0;s<o;s++)for(let c=0;c<o;c++)if(((i=this.board[s][c])==null?void 0:i[0])==="b"&&g(this,{x:c,y:s},this.board[s][c]).some(d=>d.x===t.x&&d.y===t.y)){this.whiteChecked=!0;break e}}move(e,t){var s,c,h,d;const l=this.board[e.y][e.x];if(l==="wk"){const f=t.x-e.x;if(f===2){const a={x:7,y:7};this.move(a,{x:a.x-2,y:a.y})}if(f===-2){const a={x:0,y:7};this.move(a,{x:a.x+3,y:a.y})}this.canWhiteCastleQueenside=!1,this.canWhiteCastleKingside=!1}else if(l==="bk"){const f=t.x-e.x;if(f===2){const a={x:7,y:0};this.move(a,{x:a.x-2,y:a.y})}if(f===-2){const a={x:0,y:0};this.move(a,{x:a.x+3,y:a.y})}this.canBlackCastleQueenside=!1,this.canBlackCastleKingside=!1}l==="wr"?this.canWhiteCastleQueenside&&e.x===0?this.canWhiteCastleQueenside=!1:this.canWhiteCastleKingside&&e.x===7&&(this.canWhiteCastleKingside=!1):l==="br"&&(this.canBlackCastleQueenside&&e.x===0?this.canBlackCastleQueenside=!1:this.canBlackCastleKingside&&e.x===7&&(this.canBlackCastleKingside=!1)),this.board[t.y][t.x]=this.board[e.y][e.x],this.board[e.y][e.x]="";const i=t.y-e.y;l==="wp"&&t.x===((s=this.blackEnPassant)==null?void 0:s.x)&&t.y===((c=this.blackEnPassant)==null?void 0:c.y)?this.board[this.blackEnPassant.y+1][this.blackEnPassant.x]="":l==="bp"&&t.x===((h=this.whiteEnPassant)==null?void 0:h.x)&&t.y===((d=this.whiteEnPassant)==null?void 0:d.y)&&(this.board[this.whiteEnPassant.y-1][this.whiteEnPassant.x]=""),this.blackEnPassant=null,this.whiteEnPassant=null,l==="wp"&&i===-2?this.whiteEnPassant={x:t.x,y:t.y+1}:l==="bp"&&i===2&&(this.blackEnPassant={x:t.x,y:t.y-1}),l==="wp"&&t.y===0?this.board[t.y][t.x]="wq":l==="bp"&&t.y===7&&(this.board[t.y][t.x]="bq"),this.onMove&&this.onMove(e,t)}endTurn(){this.turn=1-this.turn,this.moves++,this.updateChecked(),this.onEndTurn&&this.onEndTurn()}}function I(n,e,t){const l=Q(n),i=e==="b"?"w":"b";let s=null;for(let c=0;c<o;c++)for(let h=0;h<o;h++){const d=n.board[c][h];if((d==null?void 0:d[0])===e){const f=d[1],a=$(h,c),v=O(n,{x:h,y:c},n.board[c][h]);for(let u of v){const C=$(u.x,u.y);let y=Math.random()*.1;const k=new K({...n,onEndTurn:null,onMove:null});if(k.move({x:h,y:c},u),k.endTurn(),(e==="w"?k.blackChecked:k.whiteChecked)&&(y+=.6),f==="k")u.x-h===2?y+=.6:h-u.x===2?y+=.5:y-=.5;else if(f==="p"){const m=e==="b"?u.y:o-1-u.y;m>4&&(y+=(o-m)*.1),(h===3||h===4)&&u.x===h&&(Math.abs(c-u.y)===2?y+=.7:y+=.4)}else f==="n"||f==="b"?(a&&(y+=.5),C&&(y-=.2)):f==="q"?C&&(y-=.2):f==="r"&&C&&(y-=.2);if(t>0){const m=I(k,i,t-1);m&&(y+=e==="b"?-m.value:m.value)}const A=Q(k)-l;y+=e==="b"?-A:A,(s==null||y>(s==null?void 0:s.value))&&(s={fromSquare:{x:h,y:c},toSquare:u,value:y})}}}return s&&(n.move(s.fromSquare,s.toSquare),n.endTurn()),s}function Q(n){return n.board.flat().reduce((e,t)=>t?e+D[t[1]]*(t[0]==="w"?1:-1):e,0)}const U=2;class Z{constructor(){r(this,"gameState",null);r(this,"clickLayer",null);r(this,"piecesElement",null);r(this,"cellsElement",null);r(this,"statusText",null);r(this,"gameMode","cpu");r(this,"onEndTurn",()=>{if(this.updateStatus(),this.render(),this.cellsElement.querySelectorAll(".check").forEach(e=>e.classList.remove("check")),this.gameState.blackChecked){let e;e:for(let l=0;l<o;l++)for(let i=0;i<o;i++)if(this.gameState.board[l][i]==="bk"){e={x:i,y:l};break e}this.cellsElement.querySelector(`.cell-${e.x}-${e.y}`).classList.add("check")}if(this.gameState.whiteChecked){let e;e:for(let l=0;l<o;l++)for(let i=0;i<o;i++)if(this.gameState.board[l][i]==="wk"){e={x:i,y:l};break e}this.cellsElement.querySelector(`.cell-${e.x}-${e.y}`).classList.add("check")}(this.gameState.turn===1&&this.gameMode==="cpu"||this.gameMode==="cvc")&&this.doCpuMove()});r(this,"onMove",(e,t)=>{var s,c;(s=this.cellsElement.querySelector(".last-move-from"))==null||s.classList.remove("last-move-from"),(c=this.cellsElement.querySelector(".last-move-to"))==null||c.classList.remove("last-move-to"),this.cellsElement.querySelector(`.cell-${e.x}-${e.y}`).classList.add("last-move-from"),this.cellsElement.querySelector(`.cell-${t.x}-${t.y}`).classList.add("last-move-to")});this.clickLayer=document.querySelector("#click-layer"),this.piecesElement=document.querySelector("#pieces"),this.cellsElement=document.querySelector("#cells"),this.statusText=document.querySelector("#status-text"),this.moveText=document.querySelector("#move"),this.oneOnOneButton=document.querySelector("#oneOnOne"),this.cpuButton=document.querySelector("#cpu"),this.cvcButton=document.querySelector("#cvc"),this.oneOnOneButton.addEventListener("click",()=>this.setGameMode("1v1")),this.cpuButton.addEventListener("click",()=>this.setGameMode("cpu")),this.cvcButton.addEventListener("click",()=>this.setGameMode("cvc")),this.setGameMode("cpu")}init(){var e,t;this.gameState=new K({board:X,onEndTurn:this.onEndTurn,onMove:this.onMove}),this.updateStatus(),this.render(),(e=this.cellsElement.querySelector(".last-move-from"))==null||e.classList.remove("last-move-from"),(t=this.cellsElement.querySelector(".last-move-to"))==null||t.classList.remove("last-move-to"),this.cellsElement.querySelectorAll(".check").forEach(l=>l.classList.remove("check")),this.gameMode==="cvc"&&this.doCpuMove()}doCpuMove(){setTimeout(()=>{const e=Date.now();I(this.gameState,this.gameState.turn===0?"w":"b",U),console.log("moved in "+Math.round((Date.now()-e)/1e3)+"s")},100)}render(){this.piecesElement.innerHTML="",this.gameState.board.forEach((e,t)=>{e.forEach((l,i)=>{if(l!==""){const s=document.createElement("div");s.classList.add("piece",l[0]==="w"?"white":"black"),s.style.transform=`translate(${i*50}px, ${t*50}px)`,s.textContent=N[l[1]],this.piecesElement.appendChild(s)}})})}updateStatus(){const e=this.gameState.turn===0?"White":"Black";let t;this.gameMode==="1v1"?t=e+" to move":this.gameMode==="cpu"?t=e+(this.gameState.turn===0?" to move":" thinking..."):t=e+" thinking...",this.statusText.textContent=t,this.moveText.textContent=`Move ${Math.floor(this.gameState.moves/2)+1}`}setGameMode(e){this.gameMode=e,this.init();let t;e==="cpu"?t=this.cpuButton:e==="1v1"?t=this.oneOnOneButton:e==="cvc"&&(t=this.cvcButton),[this.cpuButton,this.oneOnOneButton,this.cvcButton].forEach(l=>l.classList.remove("selected")),t.classList.add("selected")}}const x=new Z;for(let n=0;n<o;n++){const e=document.createElement("div");e.classList.add("row"),x.cellsElement.appendChild(e);for(let t=0;t<o;t++){const l=document.createElement("div");l.classList.add("cell",`cell-${t}-${n}`),e.appendChild(l)}}let L=null,w=null,B=null,p=[];const z=(n,e)=>{w&&w.classList.remove("selected"),p.length&&p.forEach(l=>l.classList.remove("valid-move")),p=[],w=x.cellsElement.querySelector(`.cell-${n.x}-${n.y}`),w.classList.add("selected"),L=n,B=e,O(x.gameState,n,e).forEach(l=>{const i=x.cellsElement.querySelector(`.cell-${l.x}-${l.y}`);i.classList.add("valid-move"),p.push(i)})},J=n=>{const e={x:Math.floor(n.offsetX/50),y:Math.floor(n.offsetY/50)},t=x.gameState.board[e.y][e.x];if((t==null?void 0:t[0])===(x.gameState.turn===0?"w":"b")){z(e,t);return}!B||!O(x.gameState,L,B).some(i=>i.x===e.x&&i.y===e.y)||(p.length&&p.forEach(i=>i.classList.remove("valid-move")),x.gameState.move(L,e),B=null,L=null,w.classList.remove("selected"),w=null,x.gameState.endTurn())};x.clickLayer.addEventListener("click",J);
